<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ingreso a Reportes de Asistencia</title>
  <link rel="stylesheet" href="estilos.css">
</head>
<body>

  <img src="imagenes/logo1.png" alt="Logo" class="logo">

  <div class="contenedor">
    <h2 class="titulo-modulo">Ingreso a Reportes de Asistencia</h2>

    <div class="tarjeta-login-asistencia">
      <form onsubmit="return verificarAcceso()">
        <label for="usuario">Usuario:</label>
        <input type="text" id="usuario" required>

        <label for="password">Contraseña:</label>
        <input type="password" id="password" required>

        <button type="submit" class="boton">Ingresar</button>
      </form>

      <p id="mensaje-error" class="mensaje-login"></p>
    </div>

    <a href="index.html" class="boton">Volver</a>
  </div>

<script>
  async function verificarAcceso() {
    const usuario = document.getElementById("usuario").value.trim();
    const password = document.getElementById("password").value;
    const mensajeError = document.getElementById("mensaje-error");

    console.log("Enviando datos...", { usuario, password });

    try {
      const respuesta = await fetch("https://script.google.com/macros/s/AKfycbylu37B0cxOnm1QCg-T0bU3VMpNEop-WFjHCQbszuZivjQKA9U9fwkOBiCyCfpf3eNOHA/exec", {
        method: "POST",
        body: JSON.stringify({ usuario, password, modulo: "REPORTES_ASISTENCIAS" }),
        headers: { "Content-Type": "application/json" }
      });

      const resultado = await respuesta.text();
      console.log("Resultado recibido del servidor:", resultado);

      if (resultado === "ACCESO_PERMITIDO") {
        sessionStorage.setItem("usuario", usuario);
        window.location.href = "reportes_asistencia.html";
      } else if (resultado === "ACCESO_DENEGADO_MODULO") {
        mensajeError.textContent = "Este usuario no tiene permiso para este módulo.";
        mensajeError.classList.add("error");
        setTimeout(() => window.location.reload(), 10000);
      } else if (resultado === "ACCESO_DENEGADO") {
        mensajeError.textContent = "Usuario o contraseña incorrectos.";
        mensajeError.classList.add("error");
        setTimeout(() => window.location.reload(), 10000);
      } else if (resultado === "MODULO_INVALIDO") {
        mensajeError.textContent = "Error de módulo. Verifica encabezado.";
        mensajeError.classList.add("error");
        setTimeout(() => window.location.reload(), 10000);
      } else {
        mensajeError.textContent = "Respuesta inesperada del servidor.";
        mensajeError.classList.add("error");
        setTimeout(() => window.location.reload(), 10000);
      }
    } catch (error) {
      console.error("Error de conexión:", error);
      mensajeError.textContent = "Error de conexión con el servidor.";
      mensajeError.classList.add("error");
      setTimeout(() => window.location.reload(), 10000);
    }

    return false;
  }
</script>


</body>
</html>
