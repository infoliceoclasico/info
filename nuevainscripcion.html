<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nueva Inscripci√≥n</title>
  <link rel="stylesheet" href="estilos.css"/>

  <script>
    // -------------------------------
    //  Inactividad: volver a index en 120 s
    // -------------------------------
    let __idleTimer;
    function resetIdle() {
      clearTimeout(__idleTimer);
      __idleTimer = setTimeout(() => (window.location.href = "index.html"), 120000);
    }

    // -------------------------------
    //  Utilidades
    // -------------------------------
    function toTitleCaseExceptDe(s) {
      if (!s) return "";
      return s
        .toLowerCase()
        .split(/\s+/)
        .map(w => (w === "de" ? "de" : w.charAt(0).toUpperCase() + w.slice(1)))
        .join(" ");
    }

    function calcularEdad(fechaInput, idCampoEdad) {
      const d = new Date(fechaInput.value);
      if (isNaN(d)) {
        document.getElementById(idCampoEdad).value = "";
        return;
      }
      const hoy = new Date();
      let edad = hoy.getFullYear() - d.getFullYear();
      const m = hoy.getMonth() - d.getMonth();
      if (m < 0 || (m === 0 && hoy.getDate() < d.getDate())) edad--;
      document.getElementById(idCampoEdad).value = edad;
    }

    function soloDigitos(str) {
      return String(str || "").replace(/\D+/g, "");
    }

    function validarTelefono(el) {
      const v = soloDigitos(el.value);
      if (v && v.length < 8) {
        el.setCustomValidity("Debe contener al menos 8 d√≠gitos.");
      } else {
        el.setCustomValidity("");
      }
      el.value = v;
    }

    const OPCIONES_GRADO = {
      "Matutina": [
        "Kinder","P√°rvulos","Preparatoria",
        "1ro. Primaria","2do. Primaria","3ro. Primaria","4to. Primaria","5to. Primaria","6to. Primaria",
        "1ro. B√°sico","2do. B√°sico","3ro. B√°sico",
        "4to. Bachillerato en Ciencias y Letras","5to. Bachillerato en Ciencias y Letras",
        "4to. Bachillerato en Computaci√≥n","5to. Bachillerato en Computaci√≥n",
        "4to. Bachillerato en Dibujo T√©cnico","5to. Bachillerato en Dibujo T√©cnico",
        "4to. Perito Contador","5to. Perito Contador","6to. Perito Contador",
        "4to. Perito en Administraci√≥n de Empresas","5to. Perito en Administraci√≥n de Empresas","6to. Perito en Administraci√≥n de Empresas"
      ],
      "Fin de Semana": [
        "1ro. B√°sico","2do. B√°sico","3ro. B√°sico",
        "4to. Bachillerato en Ciencias y Letras","5to. Bachillerato en Ciencias y Letras",
        "4to. Bachillerato en Computaci√≥n","5to. Bachillerato en Computaci√≥n",
        "4to. Perito Contador","5to. Perito Contador","6to. Perito Contador",
        "4to. Perito en Administraci√≥n de Empresas","5to. Perito en Administraci√≥n de Empresas","6to. Perito en Administraci√≥n de Empresas",
        "1ro. B√°sico Madurez","3ro. B√°sico Madurez","Bachillerato por Madurez"
      ],
      "Sabatina": [
        "1ro. B√°sico","2do. B√°sico","3ro. B√°sico",
        "4to. Bachillerato en Ciencias y Letras","5to. Bachillerato en Ciencias y Letras",
        "4to. Bachillerato en Computaci√≥n","5to. Bachillerato en Computaci√≥n",
        "4to. Perito Contador","5to. Perito Contador","6to. Perito Contador",
        "4to. Perito en Administraci√≥n de Empresas","5to. Perito en Administraci√≥n de Empresas","6to. Perito en Administraci√≥n de Empresas",
        "1ro. B√°sico Madurez","3ro. B√°sico Madurez","Bachillerato por Madurez"
      ]
    };

    function actualizarGrados() {
      const jornada = document.getElementById("jornada").value;
      const grado = document.getElementById("grado2026");
      grado.innerHTML = "<option value=''>Seleccione...</option>";
      const lista = OPCIONES_GRADO[jornada] || [];
      lista.forEach(g => {
        const op = document.createElement("option");
        op.value = g; op.textContent = g;
        grado.appendChild(op);
      });
    }

    function validarFormulario() {
      const form = document.getElementById("form-nueva");

      ["tomaDatos","apellidosEncargado","nombresEncargado","direccion",
       "ocupacion","lugarTrabajo","apellidosAlumno","nombresAlumno",
       "contacto1","contacto2"].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = toTitleCaseExceptDe(el.value.trim());
      });

      const correo = document.getElementById("correo");
      if (correo && correo.value) correo.value = correo.value.trim().toLowerCase();

      const dpi = document.getElementById("dpi");
      if (dpi) {
        dpi.value = soloDigitos(dpi.value);
        dpi.setCustomValidity("");
      }

      ["telResidencial","telPersonal","telTrabajo","telContacto1","telContacto2"].forEach(id => {
        const el = document.getElementById(id);
        if (el) validarTelefono(el);
      });

      if (!form.checkValidity()) {
        // marca el formulario para pintar los inv√°lidos
        form.classList.add("was-validated");
        form.reportValidity();
        const firstInvalid = form.querySelector(":invalid");
        if (firstInvalid) firstInvalid.focus();
        return false;
      }
      // limpio clase si todo ok
      form.classList.remove("was-validated");
      return true;
    }

    function setBtnStateSaving(isSaving) {
      const btn = document.getElementById("btn-guardar");
      if (!btn) return;
      if (isSaving) {
        btn.dataset.originalText = btn.textContent;
        btn.textContent = "Guardando‚Ä¶";
        btn.disabled = true;
      } else {
        btn.textContent = btn.dataset.originalText || "Guardar";
        btn.disabled = false;
      }
    }

    function guardarDatos() {
      const form = document.getElementById("form-nueva");
      if (!validarFormulario()) return;

      const params = new URLSearchParams(new FormData(form));
      setBtnStateSaving(true);

      fetch("https://script.google.com/macros/s/AKfycbzVOA-DKy--XCmtAEbgK8BZEmTJtYfRZ4T0rzxj0zTo8Shivw93WGeMfCqY7IQZT1Q/exec", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
        body: params.toString()
      })
      .then(r => r.text())
      .then(txt => {
        const t = txt.trim();
        if (t.startsWith("OK")) {
          const m = t.match(/fila\s+(\d+)/i);
          const fila = m ? m[1] : "desconocida";
          alert("DATOS INGRESADOS CORRECTAMENTE - FILA " + fila);
          form.reset();
          window.location.href = "inscripciones.html";
        } else {
          alert("Error al guardar: " + t);
        }
      })
      .catch(err => alert("Error de conexi√≥n: " + err))
      .finally(() => setBtnStateSaving(false));
    }

    // -------------------------------
    //  Inicializaci√≥n
    // -------------------------------
    document.addEventListener("DOMContentLoaded", () => {
      resetIdle();

      const hoy = new Date();
      const yyyy = hoy.getFullYear();
      const mm = String(hoy.getMonth() + 1).padStart(2, "0");
      const dd = String(hoy.getDate()).padStart(2, "0");
      const fechaISO = `${yyyy}-${mm}-${dd}`;
      const fr = document.getElementById("fechaRegistro");
      if (fr && !fr.value) fr.value = fechaISO;

      ["tomaDatos","apellidosEncargado","nombresEncargado","direccion",
       "ocupacion","lugarTrabajo","apellidosAlumno","nombresAlumno",
       "contacto1","contacto2"].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener("blur", () => el.value = toTitleCaseExceptDe(el.value));
      });

      const correo = document.getElementById("correo");
      if (correo) correo.addEventListener("blur", () => correo.value = correo.value.trim().toLowerCase());

      const dpi = document.getElementById("dpi");
      if (dpi) dpi.addEventListener("input", e => e.target.value = soloDigitos(e.target.value));
      ["telResidencial","telPersonal","telTrabajo","telContacto1","telContacto2"].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener("input", () => validarTelefono(el));
      });
    });

    ["mousemove","keypress","click","touchstart"].forEach(evt =>
      document.addEventListener(evt, resetIdle)
    );
  </script>
</head>
<body>
  <div class="contenedor">
    <header>
      <img src="imagenes/logo1.png" alt="Logo" class="logo"/>
    </header>

    <div class="tarjeta-nueva-inscripcion">
      <h1 class="titulo-nueva">Nueva Inscripci√≥n 2026</h1>

      <!-- INSTRUCCIONES -->
      <p class="instrucciones-form">
        <strong>Registro de Informaci√≥n.</strong> Ingrese los datos solicitados y, al finalizar, presione el bot√≥n <strong>Guardar</strong>.<br>
        <span>Recuerde completar <u>todos los campos</u> y en especial los marcados con <strong>*</strong> (obligatorios).</span>
      </p>

      <form id="form-nueva" class="formulario-nueva" novalidate>

        <!-- üü¶ DATOS GENERALES -->
        <div class="subbloque">DATOS GENERALES</div>

        <div>
          <label for="fechaRegistro">FECHA REGISTRO<span class="req">*</span>:</label>
          <input type="date" id="fechaRegistro" name="fechaRegistro" required>
        </div>
        <div>
          <label for="tomaDatos">TOMA DE DATOS POR<span class="req">*</span>:</label>
          <input type="text" id="tomaDatos" name="tomaDatos" required>
        </div>
        <div>
          <label for="proceso">PROCESO A REALIZAR<span class="req">*</span>:</label>
          <select id="proceso" name="proceso" required>
            <option value="">Seleccione...</option>
            <option value="Primer Ingreso">Primer Ingreso</option>
          </select>
        </div>
        <div>
          <label for="entrevista">ENTREVISTA POR<span class="req">*</span>:</label>
          <select id="entrevista" name="entrevista" required>
            <option value="">Seleccione...</option>
            <option value="Evelyn Leal">Evelyn Leal</option>
            <option value="Luis Ruiz">Luis Ruiz</option>
            <option value="Gabriela Ruano">Gabriela Ruano</option>
            <option value="Daryrin Ramirez">Daryrin Ramirez</option>
            <option value="Daniel Torres">Daniel Torres</option>
            <option value="Miguel Lemus">Miguel Lemus</option>
          </select>
        </div>

        <!-- üü© TITULAR -->
        <div class="subbloque">INFORMACI√ìN TITULAR (PADRE/MADRE/ENCARGADO)</div>

        <div>
          <label for="apellidosEncargado">APELLIDOS ENCARGADO TITULAR<span class="req">*</span>:</label>
          <input type="text" id="apellidosEncargado" name="apellidosEncargado" required>
        </div>
        <div>
          <label for="nombresEncargado">NOMBRES ENCARGADO TITULAR<span class="req">*</span>:</label>
          <input type="text" id="nombresEncargado" name="nombresEncargado" required>
        </div>
        <div>
          <label for="dpi">NO. DPI<span class="req">*</span>:</label>
          <input type="text" id="dpi" name="dpi" inputmode="numeric" placeholder="Solo n√∫meros" required>
        </div>
        <div>
          <label for="nacimientoEncargado">FECHA DE NACIMIENTO<span class="req">*</span>:</label>
          <input type="date" id="nacimientoEncargado" name="nacimientoEncargado"
                 onchange="calcularEdad(this,'edadEncargado')" required>
        </div>
        <div>
          <label for="edadEncargado">EDAD ACTUAL:</label>
          <input type="number" id="edadEncargado" name="edadEncargado" readonly>
        </div>
        <div>
          <label for="parentesco">PARENTESCO<span class="req">*</span>:</label>
          <select id="parentesco" name="parentesco" required>
            <option value="">Seleccione...</option>
            <option value="Madre">Madre</option>
            <option value="Padre">Padre</option>
            <option value="Hermano(a)">Hermano(a)</option>
            <option value="T√≠o(a)">T√≠o(a)</option>
            <option value="Abuelo(a)">Abuelo(a)</option>
            <option value="Encargado(a)">Encargado(a)</option>
            <option value="Primo(a)">Primo(a)</option>
            <option value="Mismo Alumno(a)">Mismo Alumno(a)</option>
          </select>
        </div>
        <div>
          <label for="estadoCivil">ESTADO CIVIL<span class="req">*</span>:</label>
          <select id="estadoCivil" name="estadoCivil" required>
            <option value="">Seleccione...</option>
            <option value="Soltero(a)">Soltero(a)</option>
            <option value="Casado(a)">Casado(a)</option>
            <option value="Divorciado(a)">Divorciado(a)</option>
            <option value="Viudo(a)">Viudo(a)</option>
          </select>
        </div>
        <div>
          <label for="direccion">DIRECCI√ìN DE RESIDENCIA<span class="req">*</span>:</label>
          <input type="text" id="direccion" name="direccion" required>
        </div>
        <div>
          <label for="telResidencial">TEL√âFONO RESIDENCIAL:</label>
          <input type="tel" id="telResidencial" name="telResidencial" inputmode="numeric" placeholder="8+ d√≠gitos">
        </div>
        <div>
          <label for="telPersonal">TEL√âFONO PERSONAL<span class="req">*</span>:</label>
          <input type="tel" id="telPersonal" name="telPersonal" inputmode="numeric" placeholder="8+ d√≠gitos" required>
        </div>
        <div>
          <label for="correo">CORREO ELECTR√ìNICO<span class="req">*</span>:</label>
          <input type="email" id="correo" name="correo" placeholder="usuario@dominio.com" required>
        </div>
        <div>
          <label for="ocupacion">OCUPACI√ìN, PROFESI√ìN U OFICIO<span class="req">*</span>:</label>
          <input type="text" id="ocupacion" name="ocupacion" required>
        </div>
        <div>
          <label for="lugarTrabajo">LUGAR DE TRABAJO<span class="req">*</span>:</label>
          <input type="text" id="lugarTrabajo" name="lugarTrabajo" required>
        </div>
        <div>
          <label for="telTrabajo">TEL√âFONO DE TRABAJO:</label>
          <input type="tel" id="telTrabajo" name="telTrabajo" inputmode="numeric" placeholder="8+ d√≠gitos">
        </div>

        <!-- üü® ALUMNO -->
        <div class="subbloque">INFORMACI√ìN ALUMNO</div>

        <div>
          <label for="apellidosAlumno">APELLIDOS DEL ALUMNO<span class="req">*</span>:</label>
          <input type="text" id="apellidosAlumno" name="apellidosAlumno" required>
        </div>
        <div>
          <label for="nombresAlumno">NOMBRE DEL ALUMNO<span class="req">*</span>:</label>
          <input type="text" id="nombresAlumno" name="nombresAlumno" required>
        </div>
        <div>
          <label for="nacimientoAlumno">FECHA DE NACIMIENTO (ALUMNO)<span class="req">*</span>:</label>
          <input type="date" id="nacimientoAlumno" name="nacimientoAlumno"
                 onchange="calcularEdad(this,'edadAlumno')" required>
        </div>
        <div>
          <label for="edadAlumno">EDAD ACTUAL (ALUMNO):</label>
          <input type="number" id="edadAlumno" name="edadAlumno" readonly>
        </div>
        <div>
          <label for="jornada">JORNADA DEL ALUMNO<span class="req">*</span>:</label>
          <select id="jornada" name="jornada" onchange="actualizarGrados()" required>
            <option value="">Seleccione...</option>
            <option value="Matutina">Matutina</option>
            <option value="Sabatina">Sabatina</option>
          </select>
        </div>
        <div>
          <label for="grado2026">GRADO A CURSAR EN 2026<span class="req">*</span>:</label>
          <select id="grado2026" name="grado2026" required>
            <option value="">Seleccione una jornada primero...</option>
          </select>
        </div>

        <!-- üü• CONTACTOS DE EMERGENCIA -->
        <div class="subbloque">CONTACTOS DE EMERGENCIA</div>

        <div>
          <label for="contacto1">NOMBRE DE 1ER. CONTACTO<span class="req">*</span>:</label>
          <input type="text" id="contacto1" name="contacto1" required>
        </div>
        <div>
          <label for="parentesco1">PARENTESCO DE 1ER. CONTACTO<span class="req">*</span>:</label>
          <select id="parentesco1" name="parentesco1" required>
            <option value="">Seleccione...</option>
            <option value="Madre">Madre</option>
            <option value="Padre">Padre</option>
            <option value="Hermano(a)">Hermano(a)</option>
            <option value="T√≠o(a)">T√≠o(a)</option>
            <option value="Abuelo(a)">Abuelo(a)</option>
            <option value="Encargado(a)">Encargado(a)</option>
            <option value="Primo(a)">Primo(a)</option>
            <option value="Mismo Alumno(a)">Mismo Alumno(a)</option>
          </select>
        </div>
        <div>
          <label for="telContacto1">TEL√âFONO DE 1ER. CONTACTO<span class="req">*</span>:</label>
          <input type="tel" id="telContacto1" name="telContacto1" inputmode="numeric" placeholder="8+ d√≠gitos" required>
        </div>
        <div>
          <label for="contacto2"> NOMBRE DE 2DO. CONTACTO:</label>
          <input type="text" id="contacto2" name="contacto2">
        </div>
        <div>
          <label for="parentesco2"> PARENTESCO DE 2DO. CONTACTO:</label>
          <select id="parentesco2" name="parentesco2">
            <option value="">Seleccione...</option>
            <option value="Madre">Madre</option>
            <option value="Padre">Padre</option>
            <option value="Hermano(a)">Hermano(a)</option>
            <option value="T√≠o(a)">T√≠o(a)</option>
            <option value="Abuelo(a)">Abuelo(a)</option>
            <option value="Encargado(a)">Encargado(a)</option>
            <option value="Primo(a)">Primo(a)</option>
            <option value="Mismo Alumno(a)">Mismo Alumno(a)</option>
          </select>
        </div>
        <div>
          <label for="telContacto2">TEL√âFONO DE 2DO. CONTACTO:</label>
          <input type="tel" id="telContacto2" name="telContacto2" inputmode="numeric" placeholder="8+ d√≠gitos">
        </div>

        <!-- Botones -->
        <div class="botones-nueva">
          <button type="button" id="btn-guardar" class="boton" onclick="guardarDatos()">Guardar</button>
          <a href="inscripciones.html" class="boton">Volver</a>
        </div>

      </form>
    </div>
  </div>
</body>
</html>
